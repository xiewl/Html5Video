"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}!function(e,t){var i=null,s=null,o=0,a=0,l=function(){function e(i,s){if(_classCallCheck(this,e),!i)throw"input video container selector";this.selector=t.querySelector(i),this.options=Object.assign({fullscreen:!1,fullscreenRatio:.95,title:"视频播放",volume:1,playbackRate:1,loop:!1,preload:"auto"},s),this.player=null}return _createClass(e,[{key:"init",value:function(){this.selector.addEventListener("click",this.clickHandler.bind(this)),this.selector.innerHTML=e.renderHtml(),this.player=this.selector.querySelector(".html-5-video-player"),this.player.src=this.options.src,this.player.poster=this.options.poster,this.player.preload=this.options.preload,this.selector.querySelector(".html-5-video-title-text").innerText=this.options.title,this.setVideoPlaySpeed(!0),this.setVideoLoop(!0),this.videoPlayListener(),this.videoProgressRangeListener(),e.getOs().ios?(this.selector.querySelector("#voiceTitle").style.display="none",this.selector.querySelector(".html-5-video-drawer-voice-progress").style.display="none"):(this.setVideoVolume(!0),this.videoVoiceRangeListener())}},{key:"setVideoVolume",value:function(e){this.player.volume=this.options.volume;var t=parseInt(100*this.player.volume);this.selector.querySelector(".html-5-video-drawer-voice-range").value=t,this.selector.querySelector(".html-5-video-drawer-voice-range").style.backgroundSize=t+"% 100%",!e&&this.showTips("音量 ".concat(t,"%"))}},{key:"setVideoPlaySpeed",value:function(e){this.player.playbackRate=this.options.playbackRate,this.selector.querySelector(".html-5-video-drawer-speed-item.active")&&this.selector.querySelector(".html-5-video-drawer-speed-item.active").classList.remove("active"),this.selector.querySelector('.html-5-video-drawer-speed-item[data-speed="'.concat(this.player.playbackRate,'"]'))&&this.selector.querySelector('.html-5-video-drawer-speed-item[data-speed="'.concat(this.player.playbackRate,'"]')).classList.add("active"),!e&&this.showTips("播放速度 x".concat(this.player.playbackRate.toFixed(2)))}},{key:"setVideoLoop",value:function(e){this.player.loop=this.options.loop,this.selector.querySelector(".html-5-video-drawer-loop-item.active")&&this.selector.querySelector(".html-5-video-drawer-loop-item.active").classList.remove("active");var t=this.player.loop?"open":"close";this.selector.querySelector('.html-5-video-drawer-loop-item[data-loop="'.concat(t,'"]')).classList.add("active"),!e&&this.showTips(this.player.loop?"循环播放已开启":"循环播放已关闭")}},{key:"videoPlayListener",value:function(){var t=this;this.player.addEventListener("loadedmetadata",function(){t.selector.querySelector(".html-5-video-controls-total-time").innerText=e.formatToMinute(t.player.duration)}),this.player.addEventListener("timeupdate",function(){var i=100/t.player.duration*t.player.currentTime;t.selector.querySelector(".html-5-video-progress-range").value=i,t.selector.querySelector(".html-5-video-progress-range").style.backgroundSize=i+"% 100%",t.selector.querySelector(".html-5-video-controls-current-time").innerText=e.formatToMinute(t.player.currentTime)}),this.player.addEventListener("playing",function(){o=0}),this.player.addEventListener("ended",function(){t.options.loop||(t.player.currentTime=0,t.pause())}),setInterval(function(){if(!t.player.paused&&!t.player.ended){if(3===o)return void(t.selector.querySelector(".html-5-video-loading-icon").style.display="block");t.selector.querySelector(".html-5-video-loading-icon").style.display="none",a===t.player.currentTime&&o++,a=t.player.currentTime}},1e3)}},{key:"videoProgressRangeListener",value:function(){var e=this,t=this.selector.querySelector(".html-5-video-progress-range");t.addEventListener("change",function(){var i=t.value;t.style.backgroundSize=i+"% 100%",e.player.currentTime=e.player.duration*(i/100)}),t.addEventListener("input",function(){var e=t.value;t.style.backgroundSize=e+"% 100%"})}},{key:"videoVoiceRangeListener",value:function(){var e=this,t=this.selector.querySelector(".html-5-video-drawer-voice-range");t.addEventListener("change",function(){e.options.volume=t.value/100,e.setVideoVolume(),e.toggleSettingDrawer(!1)}),t.addEventListener("input",function(){e.options.volume=t.value/100,e.setVideoVolume()})}},{key:"showTips",value:function(e){var t=this;clearTimeout(s),this.selector.querySelector(".html-5-video-tips").innerText=e||"",this.selector.querySelector(".html-5-video-tips").style.display="block",s=setTimeout(function(){t.selector.querySelector(".html-5-video-tips").style.display="none"},2e3)}},{key:"play",value:function(){this.player.play(),this.setPlayerClassName("playing","fresh")}},{key:"pause",value:function(){this.player.pause(),this.setPlayerClassName("pause")}},{key:"toggleFullscreen",value:function(){if(this.options.fullscreen)this.options.fullscreen=!1,t.body.style.background="#fff",this.selector.style.cssText="",this.selector.querySelector(".html-5-video-container").classList.remove("fullscreen"),this.selector.querySelector(".html-5-video-container").style.cssText="";else{this.options.fullscreen=!0;var e,i,s=t.documentElement.clientWidth,o=t.documentElement.clientHeight,a=this.player.offsetWidth,l=this.player.offsetHeight;if(t.body.style.background="#000",this.selector.style.cssText="z-index: 999; position: fixed; width: 100%; height: 100%; left: 0; top: 0; background: #000;",this.selector.querySelector(".html-5-video-container").classList.add("fullscreen"),o>s){var r=this.options.fullscreenRatio;o*l/a<s?(e=o*r,i=o*l/a*r):(e=s*a/l*r,i=s*r),this.selector.querySelector(".html-5-video-container").style.cssText="transform: rotate(90deg) translate(".concat((o-i)/2,"px, ").concat((e-s)/2,"px); width: ").concat(e,"px")}}}},{key:"toggleSettingDrawer",value:function(e){"boolean"==typeof e?this.selector.querySelector(".html-5-video-setting-drawer-container").classList.toggle("active",e):this.selector.querySelector(".html-5-video-setting-drawer-container").classList.toggle("active")}},{key:"setPlayerClassName",value:function(){this.selector.querySelector(".html-5-video-container").className="html-5-video-container",this.options.fullscreen&&this.selector.querySelector(".html-5-video-container").classList.add("fullscreen"),t.body.classList.add.apply(this.selector.querySelector(".html-5-video-container").classList,arguments)}},{key:"clickHandler",value:function(t){var s=this;switch(t.target.id){case"playIcon":clearTimeout(i),this.toggleSettingDrawer(!1),this.play();break;case"pauseIcon":clearTimeout(i),this.toggleSettingDrawer(!1),this.pause();break;case"videoPlayer":this.toggleSettingDrawer(!1),this.player.paused||(clearTimeout(i),this.setPlayerClassName("playing"),i=setTimeout(function(){s.setPlayerClassName("playing","fresh")},1500));break;case"fullscreenIcon":case"backIcon":this.toggleFullscreen();break;case"settingIcon":this.options.fullscreen&&e.getOs().ios&&this.toggleFullscreen(),this.toggleSettingDrawer();break;default:t.target.classList.contains("html-5-video-drawer-speed-item")?(this.options.playbackRate=t.target.getAttribute("data-speed"),this.setVideoPlaySpeed(),this.toggleSettingDrawer(!1)):t.target.classList.contains("html-5-video-drawer-loop-item")&&(this.options.loop="open"===t.target.getAttribute("data-loop"),this.setVideoLoop(),this.toggleSettingDrawer(!1))}}}],[{key:"renderHtml",value:function(){return'<div class="html-5-video-container">\n                        <video class="html-5-video-player" id="videoPlayer" "webkit-playsinline"="webkit-playsinline" playsinline="playsinline"></video>\n                        <span class="html-5-video-title-container">\n                            <span class="html-5-video-back-icon" id="backIcon"></span>\n                            <span class="html-5-video-title-text"></span>\n                        </span>\n                        <span class="html-5-video-loading-icon"></span>\n                        <span class="html-5-video-play-icon" id="playIcon"></span>\n                        <span class="html-5-video-pause-icon" id="pauseIcon"></span>\n                        <div class="html-5-video-tips"></div>\n                        <div class="html-5-video-controls-container">\n                            <span class="html-5-video-controls-current-time">00:00</span>\n                            <div class="html-5-video-progress-total">\n                                <div class="html-5-video-progress-right">\n                                    <input class="html-5-video-progress-range" type="range" value="0" min="0" max="100">\n                                </div>\n                            </div>\n                            <span class="html-5-video-controls-total-time">--:--</span>\n                            <span class="html-5-video-fullscreen-icon" id="fullscreenIcon"></span>\n                            <span class="html-5-video-setting-icon" id="settingIcon"></span>\n                        </div>\n                        <div class="html-5-video-setting-drawer-container">\n                            <p class="html-5-video-drawer-title" id="voiceTitle">播放音量</p>\n                            <div class="html-5-video-drawer-voice-progress">\n                                <input class="html-5-video-drawer-voice-range" type="range" value="100" min="0" max="100">\n                            </div>\n                            <p class="html-5-video-drawer-title">循环播放</p>\n                            <div class="html-5-video-drawer-loop-list">\n                                <a href="javascript:;" class="html-5-video-drawer-loop-item" data-loop="close">关闭</a>\n                                <a href="javascript:;" class="html-5-video-drawer-loop-item" data-loop="open">开启</a>\n                            </div>\n                            <p class="html-5-video-drawer-title">播放速度</p>\n                            <div class="html-5-video-drawer-speed-list">\n                                <a href="javascript:;" class="html-5-video-drawer-speed-item" data-speed="0.75">x 0.75 倍</a>\n                                <a href="javascript:;" class="html-5-video-drawer-speed-item" data-speed="1">x 1.00 倍</a>\n                                <a href="javascript:;" class="html-5-video-drawer-speed-item" data-speed="1.25">x 1.25 倍</a>\n                                <a href="javascript:;" class="html-5-video-drawer-speed-item" data-speed="1.5">x 1.50 倍</a>\n                                <a href="javascript:;" class="html-5-video-drawer-speed-item" data-speed="2">x 2.00 倍</a>\n                            </div>\n                        </div>\n                    </div>'}},{key:"formatToMinute",value:function(e){var t=parseInt(e/3600),i=parseInt(e/60%60);return(t>0?(t<10?"0"+t:t)+":":"")+(i<10?"0"+i:i)+":"+((e=parseInt(e%60))<10?"0"+e:e)}},{key:"getOs",value:function(){return{android:/Android/.test(navigator.userAgent),ios:/iPhone\sOS/.test(navigator.userAgent)}}}]),e}();e.html5Video=function(e,t){return new l(e,t)}}(window,document);